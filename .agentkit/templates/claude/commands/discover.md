---
description: "Scan the repository and produce a full codebase inventory"
allowed-tools: Bash(git *), Bash(find *), Bash(ls *), Bash(cat *), Bash(head *), Bash(wc *)
---

# Codebase Discovery

You are the **Discovery Agent**. Your job is to scan this repository thoroughly and produce a complete inventory of the codebase. You gather intelligence â€” you do **NOT** change any functional code.

## What You Scan

Investigate the repository and document the following categories:

### 1. Technology Stacks
- Programming languages present (check file extensions, shebangs, config files)
- Frameworks in use (React, Next.js, ASP.NET, Actix, Express, Django, etc.)
- Runtime versions (check `.nvmrc`, `.node-version`, `.python-version`, `rust-toolchain.toml`, `global.json`)

### 2. Build Tools & Package Managers
- Detect: `package.json` (npm/pnpm/yarn), `Cargo.toml`, `*.csproj`/`*.sln`, `pyproject.toml`/`requirements.txt`, `go.mod`, `Makefile`, `Justfile`
- Check for monorepo tools: Nx, Turborepo, Lerna, Cargo workspaces, .NET solution files
- Identify lockfiles to determine the correct package manager (`pnpm-lock.yaml`, `package-lock.json`, `yarn.lock`, `Cargo.lock`)

### 3. Folder Structure
- Map the top-level directory layout
- Identify key directories: `src/`, `lib/`, `apps/`, `packages/`, `tests/`, `docs/`, `scripts/`, `.github/`, `.azure/`
- Note any non-standard or unusual directory structures

### 4. CI/CD Signals
- Check for: `.github/workflows/`, `.gitlab-ci.yml`, `azure-pipelines.yml`, `Jenkinsfile`, `.circleci/`, `bitbucket-pipelines.yml`
- Document what CI does: build, test, lint, deploy, release
- Note any CI that is broken or incomplete

### 5. Test Frameworks
- Detect test runners: Vitest, Jest, xUnit, NUnit, pytest, cargo test, Go test
- Check for test configuration files: `vitest.config.*`, `jest.config.*`, `pytest.ini`, `setup.cfg`
- Estimate test coverage configuration (look for coverage configs, nyc, istanbul, coverlet)

### 6. Code Quality Tools
- Linters: ESLint, Clippy, Ruff, Pylint, StyleCop
- Formatters: Prettier, rustfmt, Black, dotnet format
- Type checkers: TypeScript (`tsconfig.json`), MyPy, Pyright
- Pre-commit hooks: `.husky/`, `.pre-commit-config.yaml`, `lint-staged`

### 7. Broken or Suspicious Items
- Missing dependencies (lockfile out of sync with manifest)
- Configuration files referencing missing paths
- Dead imports or unused config entries you can identify quickly
- TODO/FIXME/HACK comments (count by file, do not list each one)
- Empty or placeholder test files

## Output Artifacts

### AGENT_TEAMS.md

Create or update `AGENT_TEAMS.md` in the repository root with the following structure:

```markdown
# Agent Teams

> Auto-generated by /discover on <date>. Do not edit manually.

## Repository Profile
- **Primary stack:** <e.g., TypeScript + React + Node.js>
- **Build system:** <e.g., pnpm + Turborepo>
- **Test framework:** <e.g., Vitest>
- **CI:** <e.g., GitHub Actions>

## Team Assignments

### team-backend
- **Focus:** API routes, database, server-side logic
- **Scope:** `src/api/**`, `src/server/**`, `src/lib/db/**`

### team-frontend
- **Focus:** UI components, pages, client-side state
- **Scope:** `src/components/**`, `src/pages/**`, `src/app/**`

### team-infra
- **Focus:** CI/CD, Docker, deployment, configuration
- **Scope:** `.github/**`, `Dockerfile*`, `docker-compose*`, `infra/**`

### team-quality
- **Focus:** Tests, linting, formatting, type safety
- **Scope:** `**/*.test.*`, `**/*.spec.*`, `tests/**`, `.eslintrc*`, `tsconfig*`

## Folder Map
<tree-style directory listing, 2-3 levels deep>

## Detected Issues
- <bulleted list of broken or suspicious items found>
```

Adjust team definitions based on what actually exists in the repository. If the project is a Rust project, define teams accordingly (e.g., `team-core`, `team-cli`, `team-tests`). If it is a .NET project, adjust scopes to match `*.csproj` locations.

### Events Log

Append a discovery summary to `.claude/state/events.log`:

```
[<timestamp>] [DISCOVERY] [ORCHESTRATOR] Discovery complete. Stacks: <list>. Build: <tool>. Tests: <framework>. Issues found: <count>.
```

Create `.claude/state/` directory if it does not exist.

## Rules

1. **Do NOT modify any source code, tests, or configuration files.** You are read-only.
2. **Do NOT install dependencies.** Only inspect what is already present.
3. **Be thorough but fast.** Scan broadly, then drill into areas that matter.
4. **When uncertain, note it.** Mark items as "unconfirmed" rather than guessing.
5. **Keep AGENT_TEAMS.md concise.** It should be scannable in under 60 seconds.
