# AgentKit Forge

A Windows-first, polyglot AI-orchestration template repository. Provides a unified agent team framework supporting Claude Code, Cursor, Windsurf, Copilot, and Continue — with MCP/A2A protocol support.

## Quick Start

### Prerequisites

- Node.js 20+
- pnpm 9+
- PowerShell 7+ (recommended on Windows) or Bash (Linux/macOS)
- Optional: .NET SDK 8+, Python 3.11+, Rust/Cargo

### Windows

```powershell
# 1. Install agentkit runtime
pnpm -C .agentkit install

# 2. Initialize for your repo
.\.agentkit\bin\init.ps1 -RepoName MyProject

# 3. Generate all AI tool configs
.\.agentkit\bin\sync.ps1
```

### Linux / macOS

```bash
# 1. Install agentkit runtime
pnpm -C .agentkit install

# 2. Initialize for your repo
node .agentkit/engines/node/src/cli.mjs init --repoName MyProject

# 3. Generate all AI tool configs
node .agentkit/engines/node/src/cli.mjs sync
```

---

## Adoption Guide: New Repos

Use this path when starting a project from scratch.

### Step 1 — Create your repo from the template

Click **"Use this template"** on GitHub (or clone directly):

```bash
gh repo create my-org/my-project --template my-org/agentkit-forge --private --clone
cd my-project
```

### Step 2 — Install and initialize

```bash
pnpm -C .agentkit install
```

**Windows:**
```powershell
.\.agentkit\bin\init.ps1 -RepoName my-project
```

**Linux/macOS:**
```bash
node .agentkit/engines/node/src/cli.mjs init --repoName my-project
```

This does three things:
1. Copies `.agentkit/overlays/__TEMPLATE__/` to `.agentkit/overlays/my-project/`
2. Sets `repoName: my-project` in your overlay's `settings.yaml`
3. Runs `sync` to generate all AI tool configs

### Step 3 — Customize your overlay

Edit `.agentkit/overlays/my-project/settings.yaml`:

```yaml
repoName: my-project
defaultBranch: main
primaryStack: node          # node | dotnet | rust | python | auto
windowsFirst: true
renderTargets:
  - claude
  - cursor
  - windsurf
  - copilot
  - ai
```

Remove render targets you don't need. For example, a team using only Claude Code and Cursor:

```yaml
renderTargets:
  - claude
  - cursor
```

### Step 4 — Add repo-specific rules or commands

Override or extend any spec definition in your overlay files:

- `.agentkit/overlays/my-project/commands.yaml` — add project-specific slash commands
- `.agentkit/overlays/my-project/rules.yaml` — add project-specific coding rules

### Step 5 — Start working

```bash
# Discover the codebase
/discover

# Run a health check
/healthcheck

# Start orchestrated development
/orchestrate
```

### Step 6 — Commit the right files

The `.agentkit/` directory is your source of truth — commit it. Pure AI tool configs (`.claude/`, `.cursor/`, `.windsurf/`, etc.) are gitignored and regenerated by each developer via `sync`. Project-owned scaffolds (`docs/`, `CONTRIBUTING.md`, etc.) are committed after first sync.

```bash
git add .agentkit/ .gitignore .gitattributes README.md LICENSE
git commit -m "feat: initialize agentkit-forge scaffold"
```

---

## Adoption Guide: Existing Repos

Use this path to add AgentKit Forge to a project that already has code.

### Step 1 — Add the .agentkit directory

Copy or merge the `.agentkit/` directory into your repo root. If using git:

```bash
# Add agentkit-forge as a remote
git remote add agentkit-forge https://github.com/my-org/agentkit-forge.git
git fetch agentkit-forge

# Bring in just the .agentkit/ directory (and root config files)
git checkout agentkit-forge/main -- .agentkit/ .gitattributes
```

Or simply copy the folder manually.

### Step 2 — Merge the .gitignore

Append the AgentKit Forge ignore rules to your existing `.gitignore`. The key entries:

```gitignore
# AgentKit Forge — always-regenerate outputs (regenerate with: pnpm -C .agentkit agentkit:sync)
/.claude/
/.cursor/
/.windsurf/
/.ai/
/mcp/
/.github/workflows/ai-framework-ci.yml
/CLAUDE.md
/UNIFIED_AGENT_TEAMS.md
/AGENT_TEAMS.md
/QUALITY_GATES.md
/RUNBOOK_AI.md
```

> **Important:** Use leading `/` on each pattern so they only match at the repo root — not inside `.agentkit/templates/`.

### Step 3 — Install and initialize

```bash
pnpm -C .agentkit install
```

**Windows:**
```powershell
.\.agentkit\bin\init.ps1 -RepoName my-existing-project
```

**Linux/macOS:**
```bash
node .agentkit/engines/node/src/cli.mjs init --repoName my-existing-project
```

### Step 4 — Tune the overlay for your stack

Edit `.agentkit/overlays/my-existing-project/settings.yaml`:

```yaml
repoName: my-existing-project
defaultBranch: main            # or develop, trunk, etc.
primaryStack: auto             # auto-detects from Cargo.toml, package.json, etc.
windowsFirst: false            # set to true for Windows-primary teams
renderTargets:
  - claude                     # only enable tools your team uses
  - cursor
```

### Step 5 — Handle conflicts with existing configs

| Existing file | Resolution |
|---|---|
| `.claude/` directory | Back up, then let `sync` regenerate. Merge any custom commands into your overlay's `commands.yaml` |
| `.cursor/rules/` | Back up custom rules. Add them to `.agentkit/overlays/<repo>/rules.yaml` to have them rendered automatically |
| `.github/PULL_REQUEST_TEMPLATE.md` | Keep yours — sync uses scaffold-once and won't overwrite existing files |
| `.editorconfig` | Keep yours — sync uses scaffold-once and won't overwrite existing files |
| `CLAUDE.md` | Move custom instructions into your overlay or into `.agentkit/spec/` |

### Step 6 — Run sync and verify

```bash
# Regenerate all configs
node .agentkit/engines/node/src/cli.mjs sync

# Verify generated output
ls -la .claude/ .cursor/ docs/
```

### Step 7 — Validate

```bash
node .agentkit/engines/node/src/cli.mjs validate
```

This checks that all spec files parse correctly and overlay references are valid.

### Step 8 — Commit

```bash
git add .agentkit/ .gitignore .gitattributes
git commit -m "feat: adopt agentkit-forge for AI orchestration"
```

---

## Documentation

Comprehensive guides for using AgentKit Forge:

| Guide | Description |
|-------|-------------|
| **[Quick Start](.agentkit/docs/QUICK_START.md)** | Your first 15 minutes — setup, first session, command overview |
| **[Command Reference](.agentkit/docs/COMMAND_REFERENCE.md)** | All 23 commands with examples, flags, and expected outputs |
| **[Workflows](.agentkit/docs/WORKFLOWS.md)** | Worked examples: feature dev, bug fix, project audit, multi-session |
| **[Team Guide](.agentkit/docs/TEAM_GUIDE.md)** | When to use which team, decision matrix, handoff patterns |
| **[State & Sessions](.agentkit/docs/STATE_AND_SESSIONS.md)** | Orchestrator state, events log, session continuity, lock files |
| **[Customization](.agentkit/docs/CUSTOMIZATION.md)** | Overlays, settings reference, adding commands/rules/teams |
| **[Troubleshooting](.agentkit/docs/TROUBLESHOOTING.md)** | Common errors, recovery procedures, FAQ |
| **[Onboarding](.agentkit/docs/ONBOARDING.md)** | Full adoption guide with CI integration |
| **[Cost Tracking](.agentkit/docs/COST_TRACKING.md)** | Session tracking, usage reports, optimization tips |

---

## What Gets Generated

After running `sync`, these are created in your project root:

**Always-regenerate** (gitignored — regenerated every sync):

| Directory | Purpose |
|-----------|---------|
| `.claude/` | Claude Code: commands, hooks, agents, rules, state |
| `.cursor/` | Cursor IDE: rules (.mdc format) |
| `.windsurf/` | Windsurf IDE: rules + workflows |
| `.ai/` | Portable multi-IDE rules (Continue, Cursor, Windsurf) |
| `mcp/` | MCP server + A2A protocol configurations |
| `CLAUDE.md` | Root Claude Code instructions |
| `UNIFIED_AGENT_TEAMS.md` | Team definitions and routing |
| `QUALITY_GATES.md` | Quality gate checks per stack |

**Scaffold-once** (committed — generated once, then you own them):

| Directory | Purpose |
|-----------|---------|
| `docs/` | Full 8-category documentation structure |
| `AGENT_BACKLOG.md` | Backlog tracking for agent work |
| `CONTRIBUTING.md` | Contributing guide |
| `SECURITY.md` | Security policy |
| `.github/ISSUE_TEMPLATE/` | Issue templates |
| `.github/PULL_REQUEST_TEMPLATE.md` | PR template |
| `.vscode/` | Editor settings and recommended extensions |
| `.editorconfig`, `.prettierrc` | Formatting configs |

## Core Commands

| Command | Purpose |
|---------|---------|
| `/orchestrate` | Master coordinator with state persistence |
| `/discover` | Codebase scanner |
| `/plan` | Structured plan before writing code |
| `/check` | Universal quality gate (format → lint → typecheck → test) |
| `/review` | Structured code review |
| `/handoff` | Session handoff summary |
| `/sync-backlog` | Update AGENT_BACKLOG.md |

## Teams

| ID | Team | Focus |
|----|------|-------|
| T1 | BACKEND | API, services, core logic |
| T2 | FRONTEND | UI, components, PWA |
| T3 | DATA | Database, models, migrations |
| T4 | INFRA | IaC, cloud, Terraform/Bicep |
| T5 | DEVOPS | CI/CD, pipelines, automation |
| T6 | TESTING | Unit, E2E, integration tests |
| T7 | SECURITY | Auth, compliance, audit |
| T8 | DOCUMENTATION | Docs, ADRs, guides |
| T9 | PRODUCT | Features, PRDs, roadmap |
| T10 | QUALITY | Code review, refactoring, bugs |

## Architecture

```
.agentkit/          ← Canonical source of truth (committed, hidden)
├── spec/           ← Team, command, rule definitions (YAML)
├── templates/      ← Output templates per tool
├── overlays/       ← Per-repo customizations
├── engines/node/   ← Sync engine (Node.js)
└── bin/            ← Windows-first command surface (.ps1 + .cmd)

.claude/            ← Generated (not committed)
.cursor/            ← Generated (not committed)
.windsurf/          ← Generated (not committed)
```

## Overlay System

Each repo gets its own overlay directory under `.agentkit/overlays/<repo-name>/`. Overlays let you:

- **Override commands** — Add project-specific slash commands or modify built-in ones
- **Override rules** — Add coding standards specific to your project
- **Configure settings** — Choose which tools to generate configs for, set your default branch, select your primary tech stack

Overlay values take precedence over `.agentkit/spec/` defaults. This means the same `.agentkit/` directory can power multiple repos with different configurations.

## Lifecycle: Why `.agentkit/` Lives in Your Repo

The `.agentkit/` directory is **not** scaffolding you delete after setup. It stays committed in your repository as the permanent source of truth for all generated AI tool configs, slash commands, rules, and orchestration logic. The dot prefix signals it's infrastructure — like `.github/` or `.vscode/` — not your application code.

**Why keep it:**
- Your overlay customizations (`.agentkit/overlays/<repo>/`) are repo-specific — they define your project's teams, commands, and rules
- Every developer runs `pnpm -C .agentkit agentkit:sync` after cloning to regenerate their local `.claude/`, `.cursor/`, `.windsurf/`, etc.
- Upgrades come from merging upstream changes into `.agentkit/`, not from re-running an installer
- The CI pipeline validates that your specs and generated outputs stay consistent

**What NOT to commit:**
- Generated AI tool configs (`.claude/`, `.cursor/`, `.windsurf/`, etc.) are gitignored
- `.agentkit/node_modules/` is gitignored
- `.agentkit/logs/` is gitignored

**First-run expectations:** The first `/orchestrate` run on a new repo will produce a backlog (`AGENT_BACKLOG.md`) that may include items about the agentkit framework itself (e.g., "no app source code exists", "scaffold README"). These are expected for a fresh project — they reflect the consuming repo's current state, not problems with the agentkit.

---

## Upgrading AgentKit Forge

AgentKit Forge uses a **git-merge upgrade model**. Your repo's `.agentkit/` directory tracks an upstream template, and you pull in updates via merge.

### One-time setup (if not already configured)

```bash
# Add the upstream template as a remote
git remote add agentkit-forge https://github.com/my-org/agentkit-forge.git
```

### Pulling updates

```bash
# Fetch latest changes
git fetch agentkit-forge

# Merge into your branch
# Use --allow-unrelated-histories on first merge if you used "Use this template"
git merge agentkit-forge/main --allow-unrelated-histories
```

### After merging

```bash
# Install any new/updated dependencies
pnpm -C .agentkit install

# Regenerate all AI tool configs with updated templates
pnpm -C .agentkit agentkit:sync

# Validate everything is consistent
pnpm -C .agentkit agentkit:validate

# Commit the result
git add .agentkit/ .gitignore .gitattributes
git commit -m "chore: upgrade agentkit-forge to latest"
```

### What merges cleanly vs. what needs attention

| Component | Merge behaviour |
|-----------|-----------------|
| `.agentkit/engines/` | Auto-merges unless you modified engine source |
| `.agentkit/spec/` | Auto-merges; new teams/commands appear automatically |
| `.agentkit/templates/` | Auto-merges; new template files appear, existing ones update |
| `.agentkit/overlays/__TEMPLATE__/` | Auto-merges; your repo-specific overlay is untouched |
| `.agentkit/overlays/<your-repo>/` | **Never touched by upstream** — this is your customization |
| `.agentkit/package.json` | May conflict if both sides changed versions — resolve manually |

### Version pinning

The current agentkit version is defined in `.agentkit/package.json` → `version`. After upgrading, check the version to confirm the merge landed:

```bash
node -e "console.log(require('./.agentkit/package.json').version)"
```

## License

MIT
